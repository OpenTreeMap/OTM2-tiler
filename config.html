<!DOCTYPE html>

<html>
<head>
  <title>config.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="addDefaultsToFilter.html">
                  addDefaultsToFilter.js
                </a>
              
                
                <a class="source" href="config.html">
                  config.js
                </a>
              
                
                <a class="source" href="displayFiltersToWhere.html">
                  displayFiltersToWhere.js
                </a>
              
                
                <a class="source" href="filterObjectToWhere.html">
                  filterObjectToWhere.js
                </a>
              
                
                <a class="source" href="filterObjectUtils.html">
                  filterObjectUtils.js
                </a>
              
                
                <a class="source" href="filtersToTables.html">
                  filtersToTables.js
                </a>
              
                
                <a class="source" href="healthCheck.html">
                  healthCheck.js
                </a>
              
                
                <a class="source" href="makeSql.html">
                  makeSql.js
                </a>
              
                
                <a class="source" href="server.html">
                  server.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>config.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> canopyBoundarySql = [
    <span class="hljs-string">"SELECT the_geom_webmercator"</span>,
    <span class="hljs-string">", canopy_percent * 100 as percent"</span>,
    <span class="hljs-string">", FORMAT('%s (%s%%)',"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Remove parent boundary name suffix.
Ex. Pittsburgh (Allegheny) -&gt; Pittsburgh</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">"    SPLIT_PART(name, ' (', 1),"</span>,
    <span class="hljs-string">"    ROUND(CAST(canopy_percent * 100 AS numeric), 1)) as label"</span>,
    <span class="hljs-string">" FROM treemap_boundary AS b"</span>,
    <span class="hljs-string">" INNER JOIN treemap_instance_boundaries AS ib ON ib.boundary_id = b.id"</span>,
    <span class="hljs-string">" WHERE ib.instance_id = &lt;%= instanceid %&gt;"</span>,
    <span class="hljs-string">" AND b.category = '&lt;%= category %&gt;'"</span>,
    <span class="hljs-string">" AND b.canopy_percent IS NOT NULL"</span>,
    <span class="hljs-string">" AND b.canopy_percent &gt;= &lt;%= canopy_min %&gt;"</span>,
    <span class="hljs-string">" AND b.canopy_percent &lt;= &lt;%= canopy_max %&gt;"</span>,
].join(<span class="hljs-string">''</span>);

<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-string">"filterQueryArgumentName"</span>: <span class="hljs-string">"q"</span>,
    <span class="hljs-string">"displayQueryArgumentName"</span>: <span class="hljs-string">"show"</span>,
    <span class="hljs-string">"restrictFeatureQueryArgumentName"</span>: <span class="hljs-string">"restrict"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This is the column name of the hstore column used for scalar udfs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-string">"scalar_udf_field"</span>: <span class="hljs-string">"udfs"</span>,
    <span class="hljs-string">"sqlForMapFeatures"</span>: {
        <span class="hljs-string">"fields"</span>: {
            <span class="hljs-string">"geom"</span>: {
                <span class="hljs-string">"point"</span>: <span class="hljs-string">"the_geom_webmercator"</span>,
                <span class="hljs-string">"polygon"</span>: <span class="hljs-string">"stormwater_polygonalmapfeature.polygon"</span>
            },
            <span class="hljs-string">"base"</span>: <span class="hljs-string">"feature_type, treemap_tree.id AS tree_id"</span>,
            <span class="hljs-string">"polygon"</span>: <span class="hljs-string">"feature_type"</span>,
            <span class="hljs-string">"utfGrid"</span>: <span class="hljs-string">"feature_type, treemap_mapfeature.id AS id"</span>
        },
        <span class="hljs-string">"basePointModel"</span>: <span class="hljs-string">"mapFeature"</span>,
        <span class="hljs-string">"basePolygonModel"</span>: <span class="hljs-string">"polygonalMapFeature"</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The tables object gets walked by filtersToTables to build the FROM and JOIN clauses of the SQL string.
The “depends” property of each item should include any tables used in the “sql” property to JOIN to that table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"tables"</span>: {
            <span class="hljs-string">"mapFeature"</span>: {
                <span class="hljs-string">"depends"</span>: [],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"treemap_mapfeature"</span>
            },
            <span class="hljs-string">"polygonalMapFeature"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"LEFT OUTER JOIN stormwater_polygonalmapfeature ON stormwater_polygonalmapfeature.mapfeature_ptr_id = treemap_mapfeature.id"</span>
            },
            <span class="hljs-string">"plot"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"JOIN treemap_plot ON treemap_mapfeature.id = treemap_plot.mapfeature_ptr_id"</span>
            },
            <span class="hljs-string">"rainBarrel"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"JOIN stormwater_rainbarrel ON treemap_mapfeature.id = stormwater_rainbarrel.mapfeature_ptr_id"</span>
            },
            <span class="hljs-string">"rainGarden"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"JOIN stormwater_raingarden ON treemap_mapfeature.id = stormwater_raingarden.polygonalmapfeature_ptr_id"</span>
            },
            <span class="hljs-string">"bioswale"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"JOIN stormwater_bioswale ON treemap_mapfeature.id = stormwater_bioswale.polygonalmapfeature_ptr_id"</span>
            },
            <span class="hljs-string">"tree"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"LEFT OUTER JOIN treemap_tree ON treemap_mapfeature.id = treemap_tree.plot_id"</span>
            },
            <span class="hljs-string">"species"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>, <span class="hljs-string">"tree"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"LEFT OUTER JOIN treemap_species ON treemap_tree.species_id = treemap_species.id"</span>
            },
            <span class="hljs-string">"mapFeaturePhoto"</span>: {
                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],
                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"LEFT OUTER JOIN treemap_mapfeaturephoto ON treemap_mapfeature.id = treemap_mapfeaturephoto.map_feature_id"</span>
            },
            <span class="hljs-string">"udf"</span>: {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Despite mapFeature not being referenced in the “sql” property it will
be used in the filter for udf and so it is required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-string">"depends"</span>: [<span class="hljs-string">"mapFeature"</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>udf uses a CROSS JOIN, but in filterObjectToWhere a restrictive WHERE clause is added</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-string">"sql"</span>: <span class="hljs-string">"CROSS JOIN treemap_userdefinedcollectionvalue"</span>
            }
        },
        <span class="hljs-string">"where"</span>: {
            <span class="hljs-string">"instance"</span> : <span class="hljs-string">"treemap_mapfeature.instance_id = &lt;%= instanceid %&gt;"</span>
        }
    },
    <span class="hljs-string">"treeDisplayFilters"</span>: [<span class="hljs-string">"EmptyPlot"</span>, <span class="hljs-string">"Tree"</span>],
    <span class="hljs-string">"boundaryGrainstoreSql"</span>: <span class="hljs-string">"SELECT the_geom_webmercator FROM treemap_boundary JOIN treemap_instance_boundaries ON treemap_instance_boundaries.boundary_id = treemap_boundary.id WHERE treemap_instance_boundaries.instance_id=&lt;%= instanceid %&gt; AND treemap_boundary.searchable=true"</span>,
    <span class="hljs-string">"getBoundarySql"</span> : <span class="hljs-string">"SELECT the_geom_webmercator FROM treemap_boundary WHERE id=&lt;%= boundaryId %&gt;"</span>,
    <span class="hljs-string">"canopyBoundarySql"</span>: canopyBoundarySql,
    <span class="hljs-string">"showAtZoomSql"</span>: <span class="hljs-string">"(treemap_mapfeature.hide_at_zoom IS NULL OR treemap_mapfeature.hide_at_zoom &lt; &lt;%= zoom %&gt;)"</span>,
    <span class="hljs-string">"customDbFieldNames"</span>: {
        <span class="hljs-string">"geom"</span>: <span class="hljs-string">"the_geom_webmercator"</span>
    },
    <span class="hljs-string">"interactivityForUtfGridRequests"</span>: <span class="hljs-string">"id"</span>,
    <span class="hljs-string">"modelMapping"</span>: {
        <span class="hljs-string">"mapFeature"</span>: <span class="hljs-string">"treemap_mapfeature"</span>,
        <span class="hljs-string">"polygonalMapFeature"</span>: <span class="hljs-string">"stormwater_polygonalmapfeature"</span>,
        <span class="hljs-string">"tree"</span>: <span class="hljs-string">"treemap_tree"</span>,
        <span class="hljs-string">"plot"</span>: <span class="hljs-string">"treemap_plot"</span>,
        <span class="hljs-string">"rainBarrel"</span>: <span class="hljs-string">"stormwater_rainbarrel"</span>,
        <span class="hljs-string">"rainGarden"</span>: <span class="hljs-string">"stormwater_raingarden"</span>,
        <span class="hljs-string">"bioswale"</span>: <span class="hljs-string">"stormwater_bioswale"</span>,
        <span class="hljs-string">"species"</span>: <span class="hljs-string">"treemap_species"</span>,
        <span class="hljs-string">"mapFeaturePhoto"</span>: <span class="hljs-string">"treemap_mapfeaturephoto"</span>,
        <span class="hljs-string">"udf"</span>: <span class="hljs-string">"treemap_userdefinedcollectionvalue"</span>
    },
    <span class="hljs-string">"udfcTemplates"</span>: {
        <span class="hljs-string">"tree"</span>: <span class="hljs-string">"treemap_userdefinedcollectionvalue.field_definition_id=&lt;%= fieldDefId %&gt; AND treemap_userdefinedcollectionvalue.model_id=treemap_tree.id"</span>,
        <span class="hljs-string">"mapFeature"</span>: <span class="hljs-string">"treemap_userdefinedcollectionvalue.field_definition_id=&lt;%= fieldDefId %&gt; AND treemap_userdefinedcollectionvalue.model_id=treemap_mapfeature.id"</span>,
    },
    <span class="hljs-string">"treeMarkerMaxWidth"</span>: <span class="hljs-number">20</span>
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
